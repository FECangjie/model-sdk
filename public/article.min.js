"use strict";console.log(ort);const t=640,o=640,n=3,a=4,e=25200,r=7,h=.25,c=.45,d=7680;function i(t,o,n,a){return[Math.round(t-n/2),Math.round(t+n/2),Math.round(o-a/2),Math.round(o+a/2)]}function s(t,o,n,a,e,r,h,c){let[d,s,l,u]=i(t,o,n,a);const g=n*a;let[M,f,m,v]=i(e,r,h,c);const w=h*c,p=Math.max(d,M),x=Math.min(s,f),I=Math.max(l,m),y=Math.min(u,v),E=Math.max(0,x-p)*Math.max(0,y-I);return E/(g+w-E)}function l(l){if(null!=l){const u=new Float32Array(t*o*3);console.log(l.height,l.width),console.assert(640===l.height,"bad height, expect 640"),console.assert(640===l.width,"bad width, expect 640"),function(a,e){const r=new Uint8Array(a.data),h=4*a.width;for(var c=0,d=0;d<n;++d)for(var i=0;i<t;++i){const t=Math.round(1*i)*h;for(var s=0;s<o;++s){var l=r[t+4*Math.round(1*s)+d]/255;e[c]=l,c++}}}(l,u),console.log("3");const g=new ort.Tensor("float32",u,[1,3,t,o]);ort.InferenceSession.create("./lib/nano.onnx").then((n=>{console.log("4"),n.run({input:g}).then((n=>{console.log("5"),function(n,l,u){for(var g=[],M=0;M<e;M++){var f=n.subarray(M*r,(M+1)*r);if(f[a]>h){let t=0,o=0;for(var m=5;m<r;m++)f[m]>t&&(t=f[m],o=m-5);const n=f[a]*t;if(n>h){var v=d*o;g.push([f[0]+v,f[1]+v,f[2],f[3],n,o])}}}console.log("candidates:",g),g=g.sort(((t,o)=>o[a]-t[a]));var w=[];g.forEach((t=>{let o=!0;for(var n=0;n<w.length;n++)s(t[0],t[1],t[2],t[3],w[n][0],w[n][1],w[n][2],w[n][3])>c&&(o=!1);o&&w.push(t)}));var p=u/o,x=l/t,I=[];w.forEach((t=>{var o=d*t[5];let[n,a,e,r]=i(Math.round(t[0])-o,Math.round(t[1])-o,Math.round(t[2]),Math.round(t[3]));n=Math.round(n*p),a=Math.round(a*p),e=Math.round(e*x),r=Math.round(r*x),I.push([n,a,e,r,t[4],t[5]])}));let y="";I.forEach((t=>{y+="["+t.toString()+"]\n"}))}(n.output.data,l.height,l.width)}))}))}}window.loadImage=()=>{console.log("启动物品模型");const n=document.getElementById("myImg");var a=document.createElement("canvas"),e=a.getContext("2d");a.width=o,a.height=t,null==e||e.drawImage(n,0,0,n.width,n.height);var r=e.getImageData(0,0,a.width,a.height),h=a.toDataURL("image/png");l(r),h.split(",")[1]};
