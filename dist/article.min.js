"use strict";console.log(ort);const t=640,o=640,n=3,a=4,r=25200,e=7,h=.25,c=.45,s=7680;function u(t,o,n,a){return[Math.round(t-n/2),Math.round(t+n/2),Math.round(o-a/2),Math.round(o+a/2)]}function l(t,o,n,a,r,e,h,c){let[s,l,d,i]=u(t,o,n,a);const M=n*a;let[f,g,v,m]=u(r,e,h,c);const w=h*c,p=Math.max(s,f),x=Math.min(l,g),y=Math.max(d,v),b=Math.min(i,m),E=Math.max(0,x-p)*Math.max(0,b-y);return E/(M+w-E)}function d(d){if(null!=d){const i=new Float32Array(t*o*3);console.log(d.height,d.width),console.assert(640===d.height,"bad height, expect 640"),console.assert(640===d.width,"bad width, expect 640"),function(a,r){const e=new Uint8Array(a.data),h=4*a.width;for(var c=0,s=0;s<n;++s)for(var u=0;u<t;++u){const t=Math.round(1*u)*h;for(var l=0;l<o;++l){var d=e[t+4*Math.round(1*l)+s]/255;r[c]=d,c++}}}(d,i),console.log("3");const M=new ort.Tensor("float32",i,[1,3,t,o]);ort.InferenceSession.create("./lib/nano.onnx").then((n=>{console.log("4"),n.run({input:M}).then((n=>{console.log("5"),function(n,d,i){for(var M=[],f=0;f<r;f++){var g=n.subarray(f*e,(f+1)*e);if(g[a]>h){let t=0,o=0;for(var v=5;v<e;v++)g[v]>t&&(t=g[v],o=v-5);const n=g[a]*t;if(n>h){var m=s*o;M.push([g[0]+m,g[1]+m,g[2],g[3],n,o])}}}console.log("candidates:",M),M=M.sort(((t,o)=>o[a]-t[a]));var w=[];M.forEach((t=>{let o=!0;for(var n=0;n<w.length;n++)l(t[0],t[1],t[2],t[3],w[n][0],w[n][1],w[n][2],w[n][3])>c&&(o=!1);o&&w.push(t)}));var p=i/o,x=d/t,y=[];w.forEach((t=>{var o=s*t[5];let[n,a,r,e]=u(Math.round(t[0])-o,Math.round(t[1])-o,Math.round(t[2]),Math.round(t[3]));n=Math.round(n*p),a=Math.round(a*p),r=Math.round(r*x),e=Math.round(e*x),y.push([n,a,r,e,t[4],t[5]])}));let b="";y.forEach((t=>{b+="["+t.toString()+"]\n"}))}(n.output.data,d.height,d.width)}))}))}}window.loadImage=()=>{console.log("启动物品模型");d(document.getElementById("myImg"))};
